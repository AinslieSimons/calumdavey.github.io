install.packages('clusterPower')
# Chunk 1
#install.packages('clusterPower')
library(clusterPower)
# Chunk 2
m0 <- 40
#m_sd <- 20 # leaving m as constant for now, although should vary
# Chunk 3
p_t <- .88*.71 + (1-.88)*.41
# Chunk 4
p_c <- .88*.66 + (1-.88)*.23 # this is the overall employment level for the STAR report
p_c <- p_c * seq(.5,1,.1)
# Chunk 5
icc <- seq(0.1,0.4,0.05)
# Chunk 6
d <- cbind(rep(p_c,times=length(icc)), rep(icc,each=length(p_c)))
d <- cbind(d, rep(p_t, nrow(d)), rep(m0, nrow(d)))
# Chunk 7
d <- cbind(d, apply(d,1,function(x) crtpwr.2prop(n=x[4], p1=x[1], p2=x[3], icc=x[2])))
# Chunk 8
plot(d[,1], d[,5], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(50,350,50), col='gray80')
for (j in unique(d[,2])){
lines(x=d[d[,2]==j,1],y=d[d[,2]==j,5])
}
abline(h = 25, col='red')
mtext(icc, side=4, at=d[d[,1]==max(p_c),5], las=1)
text(x=.355,y=30,labels='25 clusters per arm', col='red')
head(d)
?rep
d <- cbind(rep(d, each=length(m1)), rep(m1, each=length(d)))
m1 <- c(40,30,20)
d <- cbind(rep(d, each=length(m1)), rep(m1, each=length(d)))
nrow(d)
head(d)
d <- cbind(rep(p_c,times=length(icc)), rep(icc,each=length(p_c)))
d <- cbind(d, rep(p_t, nrow(d)), rep(m0, nrow(d)))
d <- cbind(d, apply(d,1,function(x) crtpwr.2prop(n=x[4], p1=x[1], p2=x[3], icc=x[2])))
head(d)
nrow(d)
d <- cbind(d[rep(seq_len(nrow(d)), length(m1)), ], rep(m1, each=length(d)))
seq_len(nrow(d)
)
d <- cbind(rep(p_c,times=length(icc)), rep(icc,each=length(p_c)))
d <- cbind(d, rep(p_t, nrow(d)), rep(m0, nrow(d)))
d <- cbind(d, apply(d,1,function(x) crtpwr.2prop(n=x[4], p1=x[1], p2=x[3], icc=x[2])))
length(d)
d <- cbind(rep(p_c,times=length(icc)), rep(icc,each=length(p_c)))
d <- cbind(d, rep(p_t, nrow(d)), rep(m0, nrow(d)))
length(d)
d <- cbind(d, apply(d,1,function(x) crtpwr.2prop(n=x[4], p1=x[1], p2=x[3], icc=x[2])))
length(d)
View(d)
nrow(D)
d <- cbind(d[rep(seq_len(nrow(d)), length(m1)), ], rep(m1, each=nrow(d)))
head(D)
head(d)
nrow(D)
nrow(d)
tail(d)
d <- cbind(d, apply(d,1,function(x) crtpwr.2prop(n=x[6], p1=x[1], p2=x[3], icc=x[2])))
d <- d[d[,7]<=50, ]
nrow(d)
plot(d[,1], d[,6], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(50,350,50), col='gray80')
abline(h=seq(10,50,10), col='gray80')
for (j in unique(d[,2])){
lines(x=d[d[,2]==j,1],y=d[d[,2]==j,6])
}
head(d)
plot(d[,1], d[,6], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(10,50,10), col='gray80')
for (i in unique(d[,6])){
for (j in unique(d[,2])){
lines(x=d[d[,6]==i & d[,2]==j,1],y=d[d[,6]==i & d[,2]==j,6])
}}
plot(d[,1], d[,7], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(10,50,10), col='gray80')
for (j in unique(d[,2])){
lines(x=d[d[,2]==j,1],y=d[d[,2]==j,7])
}
plot(d[,1], d[,7], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(10,50,10), col='gray80')
for (i in unique(d[,6])){
for (j in unique(d[,2])){
lines(x=d[d[,6]==i & d[,2]==j,1],y=d[d[,6]==i &d[,2]==j,7])
}}
i
which(i %in% unique(d[,6]))
which(i , unique(d[,6]))
which(unique(d[,6]) %in% i)
i <- 30
which(unique(d[,6]) %in% i)
plot(d[,1], d[,7], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(10,50,10), col='gray80')
cols <- c('green', 'orange', 'red')
for (i in unique(d[,6])){
for (j in unique(d[,2])){
lines(x=d[d[,6]==i & d[,2]==j,1],y=d[d[,6]==i &d[,2]==j,7], col=cols[which(unique(d[,6]) %in% i)])
}}
abline(h = 25, col='red')
mtext(icc, side=4, at=d[d[,1]==max(p_c),5], las=1)
text(x=.355,y=30,labels='25 clusters per arm', col='red')
plot(d[,1], d[,7], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(10,50,10), col='gray80')
cols <- c('green', 'orange', 'red')
for (i in unique(d[,6])){
for (j in unique(d[,2])){
lines(x=d[d[,6]==i & d[,2]==j,1],y=d[d[,6]==i &d[,2]==j,7], col=cols[which(unique(d[,6]) %in% i)])
}}
abline(h = 25, col='red')
mtext(icc, side=4, at=d[d[,1]==max(p_c),5], las=1)
text(x=.355,y=27,labels='25 clusters per arm', col='red')
legend(legend=m1,fill=cols)
legend(pos='topleft', legend=m1,fill=cols)
?legend
legend(x=.3, legend=m1,fill=cols)
legend(x=.3, y=35, legend=m1,fill=cols)
plot(d[,1], d[,7], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(10,50,10), col='gray80')
cols <- c('green', 'orange', 'red')
for (i in unique(d[,6])){
for (j in unique(d[,2])){
lines(x=d[d[,6]==i & d[,2]==j,1],y=d[d[,6]==i &d[,2]==j,7], col=cols[which(unique(d[,6]) %in% i)])
}}
abline(h = 25, col='red')
mtext(icc, side=4, at=d[d[,1]==max(p_c),5], las=1)
text(x=.355,y=27,labels='25 clusters per arm', col='red')
legend(x=.3, y=40, legend=m1,fill=cols)
p_c
# Chunk 1
#install.packages('clusterPower')
library(clusterPower)
# Chunk 2
m0 <- 40
#m_sd <- 20 # leaving m as constant for now, although should vary
# Chunk 3
p_t <- .88*.71 + (1-.88)*.41
# Chunk 4
p_c <- .88*.66 + (1-.88)*.23 # this is the overall employment level for the STAR report
p_c <- p_c * seq(.5,1,.1)
# Chunk 5
icc <- seq(0.1,0.4,0.05)
# Chunk 6
d <- cbind(rep(p_c,times=length(icc)), rep(icc,each=length(p_c)))
d <- cbind(d, rep(p_t, nrow(d)), rep(m0, nrow(d)))
# Chunk 7
d <- cbind(d, apply(d,1,function(x) crtpwr.2prop(n=x[4], p1=x[1], p2=x[3], icc=x[2])))
# Chunk 8
plot(d[,1], d[,5], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(50,350,50), col='gray80')
for (j in unique(d[,2])){
lines(x=d[d[,2]==j,1],y=d[d[,2]==j,5])
}
abline(h = 25, col='red')
mtext(icc, side=4, at=d[d[,1]==max(p_c),5], las=1)
text(x=.355,y=30,labels='25 clusters per arm', col='red')
# Chunk 9
m1 <- c(40,30,20)
d <- cbind(d[rep(seq_len(nrow(d)), length(m1)), ], rep(m1, each=nrow(d)))
# Re-calculate the power
d <- cbind(d, apply(d,1,function(x) crtpwr.2prop(n=x[6], p1=x[1], p2=x[3], icc=x[2])))
# Restict to 50 clusters per arm or fewer
# d <- d[d[,7]<=50, ]
plot(d[,1], d[,7], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
plot(d[,1], d[,7], ylim=c(0,50),
xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(10,50,10), col='gray80')
cols <- c('green', 'orange', 'red')
for (i in unique(d[,6])){
for (j in unique(d[,2])){
lines(x=d[d[,6]==i & d[,2]==j,1],y=d[d[,6]==i &d[,2]==j,7], col=cols[which(unique(d[,6]) %in% i)])
}}
abline(h = 25, col='red')
mtext(icc, side=4, at=d[d[,1]==max(p_c),5], las=1)
text(x=.355,y=27,labels='25 clusters per arm', col='red')
legend(x=.3, y=40, legend=m1,fill=cols)
unique(d[,1])
_c
p_c
head(d)
text(labels=icc, x=rep(p_c[5],times=length(icc), y=d[d[,6]==m1[1] & d[,1]==p_c[5], 7])
text(labels=icc, x=rep(p_c[5],times=length(icc), y=d[d[,6]==m1[1] & d[,1]==p_c[5], 7]))
text(labels=icc, x=rep(p_c[5],times=length(icc)), y=d[d[,6]==m1[1] & d[,1]==p_c[5], 7])
text(labels=icc, x=rep(p_c[4],times=length(icc)), y=d[d[,6]==m1[1] & d[,1]==p_c[4], 7])
plot(d[,1], d[,7], ylim=c(0,50),
xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(10,50,10), col='gray80')
cols <- c('green', 'orange', 'red')
for (i in unique(d[,6])){
for (j in unique(d[,2])){
lines(x=d[d[,6]==i & d[,2]==j,1],y=d[d[,6]==i &d[,2]==j,7], col=cols[which(unique(d[,6]) %in% i)])
}}
abline(h = 25, col='red')
text(labels=paste0('ICC=',icc), x=rep(p_c[4],times=length(icc)), y=d[d[,6]==m1[1] & d[,1]==p_c[4], 7])
text(x=.355,y=27,labels='25 clusters per arm', col='red')
legend(x=.3, y=40, legend=m1,fill=cols)
m1 <- c(40,30,20,5)
d <- cbind(d[rep(seq_len(nrow(d)), length(m1)), ], rep(m1, each=nrow(d)))
# Re-calculate the power
d <- cbind(d, apply(d,1,function(x) crtpwr.2prop(n=x[6], p1=x[1], p2=x[3], icc=x[2])))
# Restict to 50 clusters per arm or fewer
# d <- d[d[,7]<=50, ]
# Chunk 1
#install.packages('clusterPower')
library(clusterPower)
# Chunk 2
m0 <- 40
#m_sd <- 20 # leaving m as constant for now, although should vary
# Chunk 3
p_t <- .88*.71 + (1-.88)*.41
# Chunk 4
p_c <- .88*.66 + (1-.88)*.23 # this is the overall employment level for the STAR report
p_c <- p_c * seq(.5,1,.1)
# Chunk 5
icc <- seq(0.1,0.4,0.05)
# Chunk 6
d <- cbind(rep(p_c,times=length(icc)), rep(icc,each=length(p_c)))
d <- cbind(d, rep(p_t, nrow(d)), rep(m0, nrow(d)))
# Chunk 7
d <- cbind(d, apply(d,1,function(x) crtpwr.2prop(n=x[4], p1=x[1], p2=x[3], icc=x[2])))
# Chunk 8
plot(d[,1], d[,5], xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(50,350,50), col='gray80')
for (j in unique(d[,2])){
lines(x=d[d[,2]==j,1],y=d[d[,2]==j,5])
}
abline(h = 25, col='red')
mtext(icc, side=4, at=d[d[,1]==max(p_c),5], las=1)
text(x=.355,y=30,labels='25 clusters per arm', col='red')
# Chunk 9
m1 <- c(40,30,20,5)
d <- cbind(d[rep(seq_len(nrow(d)), length(m1)), ], rep(m1, each=nrow(d)))
# Re-calculate the power
d <- cbind(d, apply(d,1,function(x) crtpwr.2prop(n=x[6], p1=x[1], p2=x[3], icc=x[2])))
# Restict to 50 clusters per arm or fewer
# d <- d[d[,7]<=50, ]
plot(d[,1], d[,7], ylim=c(0,50),
xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(10,50,10), col='gray80')
cols <- c('green', 'yellow', 'orange', 'red')
for (i in unique(d[,6])){
for (j in unique(d[,2])){
lines(x=d[d[,6]==i & d[,2]==j,1],y=d[d[,6]==i &d[,2]==j,7], col=cols[which(unique(d[,6]) %in% i)])
}}
abline(h = 25, col='red')
text(labels=paste0('ICC=',icc), x=rep(p_c[4],times=length(icc)), y=d[d[,6]==m1[1] & d[,1]==p_c[4], 7])
text(x=.355,y=27,labels='25 clusters per arm', col='red')
legend(x=.3, y=40, legend=m1,fill=cols)
head(d)
plot(d[,6], d[,7],
xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
plot(d[,6], d[,7], ylim=c(0,50),
xlab='Control p', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
plot(d[,6], d[,7], ylim=c(0,50),
xlab='num per cluster', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
plot(as.factor(d[,6]), d[,7], ylim=c(0,50),
xlab='num per cluster', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
plot(as.factor(d[,6]), d[,7],
xlab='num per cluster', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
plot(d[,6], d[,7], ylim=c(0,50),
xlab='num per cluster', ylab='Clusters per arm', bty="n", pch='.',
main='Number of clusters per arm\nwith p in intervention arm .67')
abline(h=seq(10,50,10), col='gray80')
cols <- c('green', 'orange', 'red')
for (i in unique(d[,1])){
for (j in unique(d[,2])){
lines(x=d[d[,1]==i & d[,2]==j,1],y=d[d[,1]==i &d[,2]==j,7], col=cols[which(unique(d[,6]) %in% i)])
}}
for (i in unique(d[,1])){
for (j in unique(d[,2])){
lines(x=d[d[,1]==i & d[,2]==j,6],y=d[d[,1]==i &d[,2]==j,7], col=cols[which(unique(d[,6]) %in% i)])
}}
for (i in unique(d[,1])){
for (j in unique(d[,2])){
lines(x=d[d[,1]==i & d[,2]==j,6],y=d[d[,1]==i &d[,2]==j,7], col=cols[which(unique(d[,1]) %in% i)])
}}
